<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rhythm Pattern Dataset & Analytics</title>
    
    <!-- VexFlow for music notation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vexflow/4.2.2/vexflow.min.js"></script>
    
    <!-- Tone.js for audio playback -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e9ecef;
        }
        
        .section-title {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .badge {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: normal;
        }
        
        /* Rhythm Grid */
        .rhythm-grid {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .step {
            aspect-ratio: 1;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            color: #adb5bd;
        }
        
        .step.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
            transform: scale(1.1);
        }
        
        .step:hover {
            border-color: #667eea;
        }
        
        .beat-markers {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            text-align: center;
            color: #6c757d;
            font-weight: 600;
        }
        
        /* Controls */
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        /* VexFlow Notation */
        #notation {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }
        
        /* Pattern Info */
        .pattern-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .info-label {
            font-size: 0.85em;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.3em;
            font-weight: 600;
            color: #212529;
            font-family: 'Courier New', monospace;
        }
        
        /* Dataset Table */
        .dataset-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .dataset-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #667eea;
            color: white;
        }
        
        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .rank-badge {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
        }
        
        .rank-badge.gold { background: #ffd700; color: #333; }
        .rank-badge.silver { background: #c0c0c0; color: #333; }
        .rank-badge.bronze { background: #cd7f32; color: white; }
        
        .binary-pattern {
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            letter-spacing: 2px;
        }
        
        .upload-highlight {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }
        
        /* Notes & Annotations */
        .notes-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .notes-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .note-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }
        
        .note-item:hover {
            background: #e9ecef;
        }
        
        .note-content {
            font-size: 1em;
            color: #212529;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .note-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85em;
            color: #6c757d;
        }
        
        .note-timestamp {
            font-style: italic;
        }
        
        .note-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
        }
        
        .note-delete:hover {
            background: #c82333;
        }
        
        .note-input-container {
            display: flex;
            gap: 10px;
        }
        
        .note-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }
        
        .note-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .notes-count {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85em;
            margin-left: 10px;
        }
        
        .note-badge {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ Rhythm Pattern Dataset & Analytics</h1>
        <p class="subtitle">32,768 Rhythm Pattern Library ‚Ä¢ Research Tool ‚Ä¢ Usage Analytics Engine</p>
        
        <!-- RHYTHM GENERATOR SECTION -->
        <div class="section">
            <h2 class="section-title">
                üéπ Rhythm Generator
                <span class="badge">4/4 Time ‚Ä¢ 16th Notes</span>
            </h2>
            
            <div class="beat-markers">
                <div>Beat 1</div>
                <div>Beat 2</div>
                <div>Beat 3</div>
                <div>Beat 4</div>
            </div>
            
            <div class="rhythm-grid" id="rhythmGrid"></div>
            
            <div class="controls">
                <button class="btn-primary" onclick="playPattern()">‚ñ∂Ô∏è Play</button>
                <button class="btn-secondary" onclick="stopPattern()">‚èπÔ∏è Stop</button>
                <button class="btn-success" onclick="uploadPattern()">üì§ Upload Pattern</button>
                <button class="btn-secondary" onclick="clearPattern()">üóëÔ∏è Clear</button>
                <button class="btn-secondary" onclick="randomPattern()">üé≤ Random</button>
            </div>
            
            <!-- Pattern Information -->
            <div class="pattern-info">
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Pattern ID</div>
                        <div class="info-value" id="currentPatternId">-</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Binary Pattern</div>
                        <div class="info-value" id="currentBinary">----------------</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Hit Count</div>
                        <div class="info-value" id="hitCount">0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Times Uploaded</div>
                        <div class="info-value" id="uploadCount">0</div>
                    </div>
                </div>
            </div>
            
            <!-- VexFlow Notation Display -->
            <div id="notation"></div>
            
            <!-- Notes & Annotations Section -->
            <div class="notes-section">
                <div class="notes-header">
                    <h3>üìù Pattern Notes & References
                        <span class="notes-count" id="notesCount">0</span>
                    </h3>
                </div>
                
                <div class="notes-list" id="notesList"></div>
                
                <div class="note-input-container">
                    <input 
                        type="text" 
                        id="noteInput" 
                        class="note-input" 
                        placeholder="Add a note about this rhythm (e.g., 'Used in Billie Jean by Michael Jackson', 'Classic Rock Beat', etc.)"
                        maxlength="200"
                    />
                    <button class="btn-primary" onclick="addNote()">üí¨ Add Note</button>
                </div>
                <p style="font-size: 0.85em; color: #6c757d; margin-top: 8px;">
                    üí° Document which songs use this pattern, genre info, or any musical context
                </p>
            </div>
        </div>
        
        <!-- DATASET ANALYTICS SECTION -->
        <div class="section">
            <h2 class="section-title">
                üìä Rhythm Pattern Dataset
                <span class="badge">Usage Analytics</span>
            </h2>
            
            <div class="dataset-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalPatterns">0</div>
                    <div class="stat-label">Total Patterns</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uniqueUploads">0</div>
                    <div class="stat-label">Unique Uploads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalUploads">0</div>
                    <div class="stat-label">Total Uploads</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="coveragePercent">0%</div>
                    <div class="stat-label">Library Coverage</div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn-primary" onclick="toggleDatasetView()">üìã View Dataset</button>
                <button class="btn-danger" onclick="resetDataset()">üîÑ Reset Dataset</button>
            </div>
            
            <div class="dataset-container" id="datasetContainer" style="display: none;">
                <table id="datasetTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Pattern ID</th>
                            <th>Binary Pattern</th>
                            <th>Upload Count</th>
                            <th>Notes</th>
                            <th>First Uploaded</th>
                            <th>Last Uploaded</th>
                        </tr>
                    </thead>
                    <tbody id="datasetBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // RHYTHM PATTERN LIBRARY INITIALIZATION
        // ============================================================================
        
        /**
         * MASTER RHYTHM PATTERN LIBRARY
         * Generates all 32,768 possible rhythm patterns (2^15)
         * Each pattern is a 16-step binary string where:
         * - First step is always '1' (X - hit)
         * - Remaining 15 steps can be '1' (hit) or '0' (sustain)
         * 
         * Pattern ID: 0 to 32767
         * Binary String: "1000100010001000" (example)
         */
        function initializeRhythmLibrary() {
            const library = {};
            
            for (let id = 0; id < 32768; id++) {
                // First step always '1', remaining 15 from binary representation
                const binary = '1' + id.toString(2).padStart(15, '0');
                library[binary] = id;
            }
            
            return library;
        }
        
        const RHYTHM_PATTERN_LIBRARY = initializeRhythmLibrary();
        
        // ============================================================================
        // DATA PERSISTENCE & STORAGE
        // ============================================================================
        
        const STORAGE_KEYS = {
            DATASET: 'user_uploaded_rhythm_dataset',
            LIBRARY: 'rhythm_pattern_library'
        };
        
        /**
         * Dataset Entry Structure:
         * {
         *   pattern_id: number,
         *   pattern_binary: string,
         *   upload_count: number,
         *   first_uploaded_timestamp: number,
         *   last_uploaded_timestamp: number
         * }
         */
        function getDataset() {
            const stored = localStorage.getItem(STORAGE_KEYS.DATASET);
            return stored ? JSON.parse(stored) : {};
        }
        
        function saveDataset(dataset) {
            localStorage.setItem(STORAGE_KEYS.DATASET, JSON.stringify(dataset));
        }
        
        // ============================================================================
        // RHYTHM GRID UI
        // ============================================================================
        
        let currentPattern = Array(16).fill(0);
        currentPattern[0] = 1; // First step always active
        
        function initializeGrid() {
            const grid = document.getElementById('rhythmGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 16; i++) {
                const step = document.createElement('div');
                step.className = 'step';
                step.textContent = i + 1;
                
                if (i === 0) {
                    step.classList.add('active');
                    step.style.cursor = 'not-allowed';
                } else {
                    step.onclick = () => toggleStep(i);
                }
                
                grid.appendChild(step);
            }
            
            updateDisplay();
        }
        
        function toggleStep(index) {
            if (index === 0) return; // First step always active
            
            currentPattern[index] = currentPattern[index] === 1 ? 0 : 1;
            
            const steps = document.querySelectorAll('.step');
            steps[index].classList.toggle('active');
            
            updateDisplay();
            renderNotation();
        }
        
        // ============================================================================
        // PATTERN CONVERSION & MATCHING
        // ============================================================================
        
        /**
         * Convert current pattern array to binary string
         * [1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0] -> "1010101010101010"
         */
        function patternToBinary(pattern) {
            return pattern.join('');
        }
        
        /**
         * Match binary pattern against library and return Pattern ID
         */
        function matchPattern(binaryString) {
            return RHYTHM_PATTERN_LIBRARY[binaryString];
        }
        
        /**
         * Get Pattern ID from binary and handle upload counting
         */
        function getPatternInfo(binaryString) {
            const patternId = matchPattern(binaryString);
            const dataset = getDataset();
            const entry = dataset[patternId];
            
            return {
                patternId,
                uploadCount: entry ? entry.upload_count : 0,
                firstUploaded: entry ? entry.first_uploaded_timestamp : null,
                lastUploaded: entry ? entry.last_uploaded_timestamp : null
            };
        }
        
        // ============================================================================
        // PATTERN UPLOAD & DATASET UPDATE
        // ============================================================================
        
        /**
         * WORKFLOW:
         * 1. Convert pattern to binary
         * 2. Match against RHYTHM_PATTERN_LIBRARY
         * 3. Update dataset with upload count and timestamps
         * 4. Persist to localStorage
         */
        function uploadPattern() {
            const binaryPattern = patternToBinary(currentPattern);
            const patternId = matchPattern(binaryPattern);
            const timestamp = Date.now();
            
            // Get current dataset
            const dataset = getDataset();
            
            // Update or create entry
            if (dataset[patternId]) {
                // Pattern exists - increment count and update timestamp
                dataset[patternId].upload_count += 1;
                dataset[patternId].last_uploaded_timestamp = timestamp;
            } else {
                // New pattern - create entry
                dataset[patternId] = {
                    pattern_id: patternId,
                    pattern_binary: binaryPattern,
                    upload_count: 1,
                    first_uploaded_timestamp: timestamp,
                    last_uploaded_timestamp: timestamp
                };
            }
            
            // Save to localStorage
            saveDataset(dataset);
            
            // Update UI
            updateDisplay();
            updateDatasetStats();
            
            // Show success feedback
            highlightUpload(patternId);
            
            alert(`‚úÖ Pattern uploaded!\n\nPattern ID: ${patternId}\nBinary: ${binaryPattern}\nTotal uploads: ${dataset[patternId].upload_count}`);
        }
        
        function highlightUpload(patternId) {
            const row = document.querySelector(`tr[data-pattern-id="${patternId}"]`);
            if (row) {
                row.classList.add('upload-highlight');
                setTimeout(() => row.classList.remove('upload-highlight'), 2000);
            }
        }
        
        // ============================================================================
        // DATASET STATISTICS & RANKING
        // ============================================================================
        
        function updateDatasetStats() {
            const dataset = getDataset();
            const entries = Object.values(dataset);
            
            // Total patterns in library
            document.getElementById('totalPatterns').textContent = '32,768';
            
            // Unique patterns uploaded
            document.getElementById('uniqueUploads').textContent = entries.length.toLocaleString();
            
            // Total upload count
            const totalUploads = entries.reduce((sum, e) => sum + e.upload_count, 0);
            document.getElementById('totalUploads').textContent = totalUploads.toLocaleString();
            
            // Coverage percentage
            const coverage = ((entries.length / 32768) * 100).toFixed(2);
            document.getElementById('coveragePercent').textContent = coverage + '%';
        }
        
        /**
         * RANKING ALGORITHM:
         * Primary sort: upload_count (descending - most used first)
         * Secondary sort: last_uploaded_timestamp (descending - most recent first)
         */
        function getRankedDataset() {
            const dataset = getDataset();
            const entries = Object.values(dataset);
            
            return entries.sort((a, b) => {
                // Primary: Upload count (higher is better)
                if (b.upload_count !== a.upload_count) {
                    return b.upload_count - a.upload_count;
                }
                // Secondary: Most recent (higher timestamp is better)
                return b.last_uploaded_timestamp - a.last_uploaded_timestamp;
            });
        }
        
        function renderDatasetTable() {
            const tbody = document.getElementById('datasetBody');
            const rankedData = getRankedDataset();
            
            if (rankedData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <div class="empty-state-icon">üì≠</div>
                            <h3>No patterns uploaded yet</h3>
                            <p>Create a rhythm pattern above and click "Upload Pattern" to start building your dataset!</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = rankedData.map((entry, index) => {
                const rank = index + 1;
                let rankBadge = `<span class="rank-badge">${rank}</span>`;
                
                if (rank === 1) rankBadge = `<span class="rank-badge gold">ü•á</span>`;
                else if (rank === 2) rankBadge = `<span class="rank-badge silver">ü•à</span>`;
                else if (rank === 3) rankBadge = `<span class="rank-badge bronze">ü•â</span>`;
                
                const firstDate = new Date(entry.first_uploaded_timestamp).toLocaleString();
                const lastDate = new Date(entry.last_uploaded_timestamp).toLocaleString();
                
                return `
                    <tr data-pattern-id="${entry.pattern_id}">
                        <td>${rankBadge}</td>
                        <td><strong>${entry.pattern_id}</strong></td>
                        <td class="binary-pattern">${entry.pattern_binary}</td>
                        <td><strong>${entry.upload_count}</strong></td>
                        <td>${firstDate}</td>
                        <td>${lastDate}</td>
                    </tr>
                `;
            }).join('');
        }
        
        function toggleDatasetView() {
            const container = document.getElementById('datasetContainer');
            const isVisible = container.style.display !== 'none';
            
            if (isVisible) {
                container.style.display = 'none';
            } else {
                renderDatasetTable();
                container.style.display = 'block';
            }
        }
        
        // ============================================================================
        // UI UPDATE & DISPLAY
        // ============================================================================
        
        function updateDisplay() {
            const binaryPattern = patternToBinary(currentPattern);
            const info = getPatternInfo(binaryPattern);
            
            document.getElementById('currentPatternId').textContent = info.patternId;
            document.getElementById('currentBinary').textContent = binaryPattern;
            document.getElementById('hitCount').textContent = currentPattern.filter(x => x === 1).length;
            document.getElementById('uploadCount').textContent = info.uploadCount;
        }
        
        // ============================================================================
        // VEXFLOW NOTATION RENDERING
        // ============================================================================
        
        function renderNotation() {
            const container = document.getElementById('notation');
            container.innerHTML = '';
            
            const VF = Vex.Flow;
            const div = container;
            const renderer = new VF.Renderer(div, VF.Renderer.Backends.SVG);
            
            renderer.resize(800, 150);
            const context = renderer.getContext();
            
            const stave = new VF.Stave(10, 0, 780);
            stave.addClef('percussion').addTimeSignature('4/4');
            stave.setContext(context).draw();
            
            // Convert pattern to VexFlow notes
            const notes = [];
            let i = 0;
            
            while (i < 16) {
                if (currentPattern[i] === 1) {
                    // Count sustain duration
                    let duration = 1;
                    while (i + duration < 16 && currentPattern[i + duration] === 0) {
                        duration++;
                    }
                    
                    // Map duration to note value
                    let noteValue = '16';
                    if (duration >= 4) noteValue = 'q';
                    else if (duration >= 2) noteValue = '8';
                    
                    notes.push(
                        new VF.StaveNote({
                            keys: ['b/4'],
                            duration: noteValue,
                            stem_direction: 1
                        })
                    );
                    
                    i += duration;
                } else {
                    i++;
                }
            }
            
            if (notes.length > 0) {
                const voice = new VF.Voice({ num_beats: 4, beat_value: 4 });
                voice.addTickables(notes);
                
                new VF.Formatter().joinVoices([voice]).format([voice], 750);
                voice.draw(context, stave);
            }
        }
        
        // ============================================================================
        // TONE.JS PLAYBACK
        // ============================================================================
        
        let isPlaying = false;
        let playbackLoop;
        
        function playPattern() {
            if (isPlaying) return;
            
            isPlaying = true;
            const synth = new Tone.MembraneSynth().toDestination();
            
            let step = 0;
            playbackLoop = new Tone.Loop((time) => {
                if (currentPattern[step] === 1) {
                    synth.triggerAttackRelease('C2', '16n', time);
                }
                
                // Visual feedback
                const steps = document.querySelectorAll('.step');
                steps.forEach(s => s.style.boxShadow = 'none');
                steps[step].style.boxShadow = '0 0 20px #667eea';
                
                step = (step + 1) % 16;
            }, '16n');
            
            Tone.Transport.start();
            playbackLoop.start(0);
        }
        
        function stopPattern() {
            if (playbackLoop) {
                playbackLoop.stop();
                playbackLoop.dispose();
            }
            Tone.Transport.stop();
            isPlaying = false;
            
            // Clear visual feedback
            document.querySelectorAll('.step').forEach(s => s.style.boxShadow = 'none');
        }
        
        // ============================================================================
        // UTILITY FUNCTIONS
        // ============================================================================
        
        function clearPattern() {
            currentPattern = Array(16).fill(0);
            currentPattern[0] = 1;
            
            const steps = document.querySelectorAll('.step');
            steps.forEach((step, i) => {
                if (i === 0) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
            
            updateDisplay();
            renderNotation();
        }
        
        function randomPattern() {
            clearPattern();
            
            for (let i = 1; i < 16; i++) {
                if (Math.random() > 0.5) {
                    toggleStep(i);
                }
            }
        }
        
        function resetDataset() {
            if (confirm('‚ö†Ô∏è Are you sure you want to reset the entire dataset?\n\nThis will delete all uploaded patterns and cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEYS.DATASET);
                updateDatasetStats();
                alert('‚úÖ Dataset has been reset!');
                
                if (document.getElementById('datasetContainer').style.display !== 'none') {
                    renderDatasetTable();
                }
            }
        }
        
        // ============================================================================
        // INITIALIZATION
        // ============================================================================
        
        document.addEventListener('DOMContentLoaded', () => {
            initializeGrid();
            renderNotation();
            updateDatasetStats();
            
            console.log('üéµ Rhythm Pattern Dataset System Initialized');
            console.log('üìä Total Patterns in Library:', Object.keys(RHYTHM_PATTERN_LIBRARY).length);
        });
    </script>
</body>
</html>