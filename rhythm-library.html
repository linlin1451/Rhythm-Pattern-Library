<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>32,768 Rhythm Pattern Library</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        const RhythmLibrary = () => {
          const [patternId, setPatternId] = useState(0);
          const [inputRhythm, setInputRhythm] = useState('X---X---X---X---');
          const [searchDistance, setSearchDistance] = useState(2);
          const [showSimilar, setShowSimilar] = useState(false);
          const [exportRange, setExportRange] = useState({ start: 0, end: 100 });
          const [showExport, setShowExport] = useState(false);

          const getPatternString = (id) => {
            if (id < 0 || id > 32767) return 'X---------------';
            let pattern = 'X';
            const binary = id.toString(2).padStart(15, '0');
            for (let i = 0; i < 15; i++) {
              pattern += binary[i] === '1' ? 'X' : '-';
            }
            return pattern;
          };

          const formatPattern = (pattern) => {
            return `${pattern.slice(0, 4)} ${pattern.slice(4, 8)} ${pattern.slice(8, 12)} ${pattern.slice(12, 16)}`;
          };

          const rhythmToId = (rhythm) => {
            const clean = rhythm.replace(/\s/g, '');
            if (clean.length !== 16 || clean[0] !== 'X') return null;
            let binary = '';
            for (let i = 1; i < 16; i++) {
              binary += (clean[i] === 'X') ? '1' : '0';
            }
            return parseInt(binary, 2);
          };

          const getNoteDurations = (pattern) => {
            const durations = [];
            let currentDuration = 1;
            for (let i = 1; i < pattern.length; i++) {
              if (pattern[i] === 'X') {
                durations.push(currentDuration);
                currentDuration = 1;
              } else {
                currentDuration++;
              }
            }
            durations.push(currentDuration);
            return durations;
          };

          const getNoteColor = (duration) => {
            if (duration >= 4) return { bg: 'bg-red-500', shadow: 'shadow-red-500/50', label: 'Quarter' };
            if (duration >= 2) return { bg: 'bg-blue-500', shadow: 'shadow-blue-500/50', label: 'Eighth' };
            return { bg: 'bg-yellow-400', shadow: 'shadow-yellow-400/50', label: 'Sixteenth' };
          };

          const findSimilarPatterns = (targetId, maxDistance, limit = 15) => {
            const matches = [];
            for (let i = 0; i < 32768 && matches.length < limit; i++) {
              if (i === targetId) continue;
              const diff = (targetId ^ i).toString(2).split('1').length - 1;
              if (diff <= maxDistance) {
                matches.push({ id: i, difference: diff });
              }
            }
            return matches.sort((a, b) => a.difference - b.difference);
          };

          const exportAllPatterns = () => {
            let text = `# 32,768 Rhythm Pattern Library\n# Format: ID: Pattern (X = hit, - = sustain)\n\n`;
            for (let i = 0; i < 32768; i++) {
              text += `${i}: ${formatPattern(getPatternString(i))}\n`;
            }
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'all_32768_rhythm_patterns.txt';
            a.click();
            URL.revokeObjectURL(url);
          };

          const currentPattern = getPatternString(patternId);
          const durations = getNoteDurations(currentPattern);

          return (
            <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white p-8">
              <div className="max-w-6xl mx-auto">
                <div className="text-center mb-12">
                  <h1 className="text-5xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                    32,768 Rhythm Patterns
                  </h1>
                  <p className="text-slate-300 text-lg">Every possible 16-step rhythm pattern • 2¹⁵ = 32,768 combinations</p>
                </div>

                <div className="bg-slate-800/50 backdrop-blur rounded-2xl p-8 mb-8 border border-purple-500/20">
                  <div className="flex items-center justify-between mb-6">
                    <h2 className="text-2xl font-semibold">Pattern #{patternId}</h2>
                    <button
                      onClick={exportAllPatterns}
                      className="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors"
                    >
                      Export All
                    </button>
                  </div>

                  <div className="mb-8">
                    <label className="block text-sm text-slate-400 mb-2">Pattern ID (0-32767)</label>
                    <input
                      type="number"
                      min="0"
                      max="32767"
                      value={patternId}
                      onChange={(e) => setPatternId(Math.max(0, Math.min(32767, parseInt(e.target.value) || 0)))}
                      className="w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-3 text-white text-lg focus:border-purple-500 focus:outline-none"
                    />
                  </div>

                  <div className="font-mono text-4xl bg-slate-900/50 p-6 rounded-lg tracking-wider mb-6">
                    {formatPattern(currentPattern).split('').map((char, i) => (
                      <span
                        key={i}
                        className={char === 'X' ? 'text-green-400 font-bold' : char === '-' ? 'text-purple-400' : 'ml-2'}
                      >
                        {char}
                      </span>
                    ))}
                  </div>

                  <div className="bg-slate-900/50 p-6 rounded-lg">
                    <div className="flex gap-1 mb-4">
                      {currentPattern.split('').map((char, i) => {
                        let noteIndex = 0;
                        for (let j = 0; j < i; j++) {
                          if (currentPattern[j] === 'X' && j !== 0) noteIndex++;
                        }
                        const isHit = char === 'X';
                        const duration = durations[noteIndex];
                        const color = getNoteColor(duration);
                        return (
                          <div key={i} className="flex flex-col items-center">
                            <div className={`w-12 h-20 rounded transition-all ${isHit ? `${color.bg} shadow-lg ${color.shadow} border-2 border-white` : `${color.bg} opacity-70`}`} />
                            <div className="text-xs text-slate-500 mt-1">{i + 1}</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>

                <div className="text-center text-slate-500 text-sm">
                  32,768 Rhythm Pattern Library
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<RhythmLibrary />, document.getElementById('root'));
    </script>
</body>
</html>